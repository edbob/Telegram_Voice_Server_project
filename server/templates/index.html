<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</title>
    <style>
        body { font-family: sans-serif; margin: 40px; }
        .msg { margin-bottom: 20px; }
        .date { color: gray; font-size: 0.9em; }
    </style>
</head>
<body>
    <h1>üó£Ô∏è –ü–æ—Å–ª–µ–¥–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h1>
    <div id="messages"></div>

    <script>
    async function fetchMessages() {
        const res = await fetch('/api/messages');
        const data = await res.json();

        const container = document.getElementById('messages');
        container.innerHTML = '';

        data.forEach(msg => {
            const div = document.createElement('div');
            div.className = 'msg';
            div.innerHTML = `
                <audio controls src="${msg.url}"></audio><br>
                <span class="date">–î–æ–±–∞–≤–ª–µ–Ω–æ: ${msg.date}</span>
            `;
            container.appendChild(div);
        });
    }

    // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
    const eventSource = new EventSource('/events');
    eventSource.onmessage = function(event) {
        if (event.data === 'new_message') {
            fetchMessages();
        }
    };

    // –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    fetchMessages();
</script>
</body>
</html>